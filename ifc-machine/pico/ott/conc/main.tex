%% \documentclass{scrartcl}
\documentclass{article}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{stmaryrd}
\usepackage{supertabular}
\usepackage{fullpage}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{bm}

\input{temp/defns}

\renewcommand{\ottkw}[1]{\mathsf{#1}}

\definecolor{dkblue}{rgb}{0,0.1,0.5}
\definecolor{dkgreen}{rgb}{0,0.3,0}
\definecolor{dkred}{rgb}{0.6,0,0}

\newcommand{\comm}[3]{\textcolor{#1}{[#2: #3]}}
\newcommand{\ch}[1]{\comm{violet}{CH}{#1}} % Catalin
\newcommand{\bcp}[1]{\comm{dkred}{BCP}{#1}} % Benjamin
\newcommand{\dd}[1]{\comm{dkblue}{DD}{#1}} % Delphine

\renewcommand{\ottdrulename}[1]{\footnotesize\textsc{#1}}
\renewcommand{\ottdrule}[4][]
           {{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}
               %% ~\ottdrulename{#4}
           }}

\DeclareMathAlphabet{\mathitbf}{OT1}{cmr}{bx}{it}

\begin{document}

\section*{Notes}

\begin{itemize}
\item Ott file for the current concrete pico machine with output.
  \begin{itemize}
    \item the user program and tmu fault handler code are implicit,
      and global to the step relation
    \item labels are represented with integers. TODO: change for
      richer data structures. Need to introduce an extra privileged
      memory for that.
    \item how to present the fault handler? Nathan's
      combinators may help the ease of presentation too.
    \item notation for fault handler cache: only payload-labels are
      specified and not their labels. these could be any labels actually.
    \item when IFC-faulting, no effect on the memory (see rule for
      Store), and the stack below the frame of the tmu fault handler
      is also unchanged, so that, when returning from it, we can
      "replay" the instruction, with a cache that is up-to-date.
  \end{itemize}
\item Questions:
  \begin{itemize}
    \item Strictly speaking, the rule for Call is returning three
      things: the next pc for callee, the next pc inside the caller,
      and the label to put on the argument passed to the function.
      this ought to be fixed, I would say. For now: just two results.
      \dd{Having all outputs coming from the TMU manager would be more
        uniform}. \bcp{Stick to two outputs, and explain that in the
        text (less hardware resource usage)}
    \item Output and privileged mode: we can either make it blocking
      (saving one rule), or make it step, but observe that the tmu
      fault handler code do use output instruction. Made it blocking
      for now.
    \item Returning from priv mode to user mode: it's wrong
      to return a value here. For now, Ret is a value return at the
      abstract level, and a void return in priv mode. Need to
      reintroduce two kinds of return instruction?
    \item For a cache size greater than 1, the notation for
      cache-miss-and-update is likely to change.
    \item Cache miss-and-update: shouldn't trigger any non-determinism.
    \item $\bot$ should really denote a default (arbitrary, fixed)
      integer label, rather than the $\bot$ element of a concrete lattice.
      Need to choose a good notation for that.
  \end{itemize}
\end{itemize}

\section*{Syntax}

\ottmetavars\\[3ex]

\ottgrammartabular{
%% \ottM\ottinterrule
%% \ottframe\ottinterrule
\ottn\ottinterrule
%% \ottp\ottinterrule
%% \ottv\ottinterrule
%% \ottov\ottinterrule
\ottpriv\ottinterrule
\ottT\ottinterrule
\ottC\ottinterrule
\ottki\ottinterrule
\ottko\ottinterrule
\ottkbot\ottinterrule
\ottca\ottinterrule
\ottinstr\ottinterrule
%% \ottopcode\ottinterrule
\ottcS\ottinterrule
}

\section*{Auxiliary relations}

\ottgrammartabular{
\ottformula\ottinterrule
}

\clearpage
\section*{Step relation: user mode - hit/faulting, kernel mode}

\[ \ottdruleNop \ottinterrule 
   \quad \quad \ottdruleNopXXF \ottinterrule \]
\[ \ottdruleOut \ottinterrule
   \quad \quad  \ottdruleOutXXF \ottinterrule \]
\[ \ottdruleBOp \ottinterrule
   \quad \quad \ottdruleBOpXXF \ottinterrule \]
\[ \ottdrulePsh \ottinterrule 
   \quad \quad \ottdrulePshXXF \ottinterrule \]
 \[ \ottdruleLd \ottinterrule 
   \quad \quad \ottdruleLdXXF \ottinterrule \]
\[ \ottdruleSt \ottinterrule
   \quad \quad \ottdruleStXXF \ottinterrule \]
\[ \ottdruleJmp \ottinterrule
   \quad \quad \ottdruleJmpXXF \ottinterrule \]
\[ \ottdruleBnz \ottinterrule 
   \quad \quad  \ottdruleBnzXXF \ottinterrule  \] 
\[ \ottdruleCll \ottinterrule
   \quad \quad  \ottdruleCllXXF \ottinterrule \]
\[ \ottdruleRet \ottinterrule   
   \quad \quad  \ottdruleRetXXF \ottinterrule \]

\section*{Step relation: privileged mode}

\[ \ottdruleNopXXP \ottinterrule \]
\[ \ottdruleBOpXXP \ottinterrule \]
\[ \ottdrulePshXXP \ottinterrule \]
\[ \ottdruleLdXXP \ottinterrule \]
\[ \ottdruleStXXP \ottinterrule \]
\[ \ottdruleJmpXXP \ottinterrule \]
\[ \ottdruleBnzXXP \ottinterrule \] 
\[ \ottdruleCllXXP \ottinterrule \]
\[ \ottdruleRetXXP \ottinterrule \] 


% \begin{quote}
% \ottgrammartabular{%
%    \ottC\ottinterrule
%    \ottt\ottinterrule
%    \ottu\ottinterrule
%    \ottv\ottinterrule
%    \ottG\ottinterrule
%    \ottbuf\ottinterrule
% }
% \end{quote}

\end{document}

% LocalWords:  canElim canReclassify injective Elim Recl TL BCP TODO
% LocalWords:  canEliminate newprin
